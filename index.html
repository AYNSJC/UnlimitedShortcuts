<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>New Tab</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #202124;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    .search-container {
      margin: 40px 0;
    }

    .search-bar {
      width: 500px;
      max-width: 90vw;
      padding: 12px 20px;
      border-radius: 24px;
      border: none;
      outline: none;
      font-size: 18px;
      background-color: #303134;
      color: white;
    }

    .groups {
      width: 90%;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .group {
      background-color: #2e2f31;
      border-radius: 16px;
      padding: 16px;
      transition: 0.3s ease;
    }

    .group-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .group-name {
      flex: 1;
      font-size: 16px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background-color: #444;
      color: white;
    }

    .collapse-btn,
    .delete-group {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }

    .group-content {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .shortcut-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 12px;
    }

    .shortcut {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .shortcut img {
      width: 32px;
      height: 32px;
      border-radius: 8px;
    }

    .shortcut-name {
      font-size: 12px;
      color: #ccc;
      background: transparent;
      border: none;
      text-align: center;
      width: 100%;
    }

    .add-shortcut {
      background-color: #3c4043;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      align-self: flex-start;
    }

    .group.collapsed .group-content {
      display: none;
    }

    .add-group {
      background-color: #3c4043;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 20px;
    }
  </style>
</head>
<body>

  <div class="search-container">
    <input class="search-bar" placeholder="Search Google..." />
  </div>

  <div class="groups" id="groups"></div>
  <button class="add-group" id="addGroupBtn">+ Add Group</button>

  <script>
    const groupsContainer = document.getElementById("groups");
    const addGroupBtn = document.getElementById("addGroupBtn");
    const searchBar = document.querySelector(".search-bar");

    searchBar.addEventListener("focus", () => {
      window.location.href = "https://www.google.com";
    });

    function createGroup(data = { name: "", shortcuts: [] }) {
      const groupDiv = document.createElement("div");
      groupDiv.classList.add("group");

      const header = document.createElement("div");
      header.classList.add("group-header");

      const nameInput = document.createElement("input");
      nameInput.className = "group-name";
      nameInput.placeholder = "Group Name";
      nameInput.value = data.name;

      const collapseBtn = document.createElement("button");
      collapseBtn.className = "collapse-btn";
      collapseBtn.textContent = "▼";

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "delete-group";
      deleteBtn.textContent = "🗑️";

      header.append(nameInput, collapseBtn, deleteBtn);

      const groupContent = document.createElement("div");
      groupContent.className = "group-content";

      const shortcutGrid = document.createElement("div");
      shortcutGrid.className = "shortcut-grid";

      data.shortcuts.forEach(s => {
        const shortcut = createShortcut(s.url, s.name);
        shortcutGrid.appendChild(shortcut);
      });

      const addBtn = document.createElement("button");
      addBtn.className = "add-shortcut";
      addBtn.textContent = "+ Website";

      groupContent.append(addBtn, shortcutGrid);
      groupDiv.append(header, groupContent);
      groupsContainer.appendChild(groupDiv);

      collapseBtn.onclick = () => {
        groupDiv.classList.toggle("collapsed");
        saveData();
      };

      deleteBtn.onclick = () => {
        groupDiv.remove();
        saveData();
      };

      nameInput.oninput = saveData;

      addBtn.onclick = () => {
        if (shortcutGrid.children.length >= 10) return;
        const url = prompt("Enter website URL:");
        if (!url) return;
        const shortcut = createShortcut(url, "Site");
        shortcutGrid.appendChild(shortcut);
        saveData();
        if (shortcutGrid.children.length >= 10) addBtn.style.display = "none";
      };

      // Hide add button if already 10
      if (shortcutGrid.children.length >= 10) addBtn.style.display = "none";

      new Sortable(shortcutGrid, {
        animation: 150,
        onEnd: saveData
      });
    }

    function createShortcut(url, name) {
      const div = document.createElement("div");
      div.className = "shortcut";
      const img = document.createElement("img");
      img.src = "https://www.google.com/s2/favicons?sz=64&domain_url=" + encodeURIComponent(url);
      const nameInput = document.createElement("input");
      nameInput.className = "shortcut-name";
      nameInput.value = name;
      nameInput.oninput = saveData;
      div.append(img, nameInput);
      div.onclick = () => window.open(url, "_blank");
      return div;
    }

    function saveData() {
      const data = [];
      document.querySelectorAll(".group").forEach(group => {
        const name = group.querySelector(".group-name").value;
        const shortcuts = [...group.querySelectorAll(".shortcut")].map(shortcut => {
          const url = shortcut.onclick.toString().match(/window\.open\("([^"]+)/)?.[1] || "";
          const name = shortcut.querySelector(".shortcut-name").value;
          return { url, name };
        });
        data.push({ name, shortcuts });
      });
      localStorage.setItem("groupsData", JSON.stringify(data));
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem("groupsData") || "[]");
      data.forEach(group => createGroup(group));
    }

    addGroupBtn.onclick = () => {
      createGroup();
      saveData();
    };

    loadData();
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
</body>
</html>
