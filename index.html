<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Start Page</title>
  <style>
    body {
      margin: 0;
      background-color: #202124;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 40px 0;
    }

    .search-box {
      margin-bottom: 40px;
    }

    input[type="text"] {
      padding: 12px 20px;
      width: 400px;
      font-size: 18px;
      border-radius: 30px;
      border: none;
      outline: none;
      background-color: #303134;
      color: white;
    }

    .group {
      margin-bottom: 40px;
      width: 100%;
      max-width: 800px;
    }

    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      background-color: #3c4043;
      padding: 8px 16px;
      border-radius: 8px;
      margin-bottom: 10px;
    }

    .group-header input {
      background: none;
      border: none;
      font-size: 18px;
      color: white;
      width: 100%;
    }

    .shortcuts {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 16px;
      justify-items: center;
    }

    .shortcut {
      width: 80px;
      height: 90px;
      border-radius: 12px;
      background-color: #303134;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      color: white;
      padding: 6px 4px;
    }

    .shortcut img {
      width: 32px;
      height: 32px;
      margin-bottom: 6px;
    }

    .label {
      font-size: 12px;
      line-height: 1.1;
      word-wrap: break-word;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .shortcut:hover {
      background-color: #3c4043;
    }

    #addShortcutBtn {
      background-color: #3c4043;
      border: 2px dashed #5f6368;
      color: #aaa;
      font-size: 32px;
      font-weight: bold;
      justify-content: center;
    }

    #addShortcutBtn:hover {
      background-color: #5f6368;
      color: white;
    }
  </style>
</head>
<body>
  <div class="search-box">
    <form>
      <input type="text" id="searchInput" placeholder="Search Google...">
    </form>
  </div>

  <div id="groupsContainer"></div>

  <script>
    document.getElementById("searchInput").addEventListener("focus", () => {
      location.href = "https://www.google.com";
    });

    let groups = JSON.parse(localStorage.getItem("groups") || "[]");

    function getFavicon(url) {
      try {
        const u = new URL(url);
        return `${u.origin}/favicon.ico`;
      } catch {
        return "https://www.google.com/s2/favicons?domain=example.com";
      }
    }

    function createGroup(groupData, index) {
      const groupDiv = document.createElement("div");
      groupDiv.className = "group";

      const header = document.createElement("div");
      header.className = "group-header";

      const input = document.createElement("input");
      input.value = groupData.name;
      input.addEventListener("input", () => {
        groups[index].name = input.value;
        saveGroups();
      });

      header.appendChild(input);

      header.addEventListener("click", () => {
        shortcutsDiv.hidden = !shortcutsDiv.hidden;
      });

      const shortcutsDiv = document.createElement("div");
      shortcutsDiv.className = "shortcuts";

      groupData.shortcuts.forEach(shortcut => {
        shortcutsDiv.appendChild(createShortcutElement(shortcut.name, shortcut.url, index));
      });

      const addBtn = document.createElement("div");
      addBtn.className = "shortcut";
      addBtn.id = "addShortcutBtn";
      addBtn.textContent = "+";
      addBtn.onclick = () => addShortcut(index, shortcutsDiv);
      shortcutsDiv.appendChild(addBtn);

      groupDiv.appendChild(header);
      groupDiv.appendChild(shortcutsDiv);

      return groupDiv;
    }

    function createShortcutElement(name, url, groupIndex) {
      const a = document.createElement("a");
      a.className = "shortcut";
      a.href = url;
      a.title = name;
      a.target = "_self";
      a.draggable = true;

      const img = document.createElement("img");
      img.src = getFavicon(url);
      img.alt = name;

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = name;

      a.appendChild(img);
      a.appendChild(label);

      a.addEventListener("contextmenu", e => {
        e.preventDefault();
        if (confirm(`Remove shortcut: "${name}"?`)) {
          a.remove();
          groups[groupIndex].shortcuts = groups[groupIndex].shortcuts.filter(s => s.url !== url);
          saveGroups();
        }
      });

      a.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", JSON.stringify({ name, url, groupIndex }));
      });

      a.addEventListener("dragover", e => e.preventDefault());

      a.addEventListener("drop", e => {
        e.preventDefault();
        const data = JSON.parse(e.dataTransfer.getData("text/plain"));
        if (data.url !== url) {
          // Swap elements in storage
          let aIndex = groups[groupIndex].shortcuts.findIndex(s => s.url === url);
          let bIndex = groups[data.groupIndex].shortcuts.findIndex(s => s.url === data.url);
          let temp = groups[groupIndex].shortcuts[aIndex];
          groups[groupIndex].shortcuts[aIndex] = groups[data.groupIndex].shortcuts[bIndex];
          groups[data.groupIndex].shortcuts[bIndex] = temp;
          saveGroups();
          location.reload();
        }
      });

      return a;
    }

    function addShortcut(groupIndex, shortcutsDiv) {
      const name = prompt("Enter shortcut name:");
      const url = prompt("Enter URL (include https://):");
      if (name && url) {
        groups[groupIndex].shortcuts.push({ name, url });
        saveGroups();
        const newShortcut = createShortcutElement(name, url, groupIndex);
        shortcutsDiv.insertBefore(newShortcut, shortcutsDiv.lastChild);
      }
    }

    function saveGroups() {
      localStorage.setItem("groups", JSON.stringify(groups));
    }

    function init() {
      const container = document.getElementById("groupsContainer");
      if (groups.length === 0) {
        groups.push({ name: "Group 1", shortcuts: [] });
        saveGroups();
      }
      groups.forEach((group, i) => {
        container.appendChild(createGroup(group, i));
      });
    }

    init();
  </script>
</body>
</html>
